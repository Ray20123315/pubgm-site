<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PUBGM å¥½å‹æ¨è–¦åŠ LINE ç¤¾ç¾¤</title>
  <style>
    body {
      font-family: Arial, "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 10px;
      background: #f9f9f9;
      color: #333;
    }
    header, footer {
      text-align: center;
      margin-bottom: 20px;
    }
    h1, h2 {
      color: #2277cc;
    }
    a.btn {
      display: inline-block;
      padding: 10px 18px;
      margin: 10px 5px;
      background: #00b900;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    a.btn:hover {
      background: #007700;
    }
    #teammate-list {
      margin-top: 20px;
    }
    .teammate-card {
      background: white;
      border-radius: 8px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
      line-height: 1.5;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ¯ PUBGM å¥½å‹æ¨è–¦åŠ LINE ç¤¾ç¾¤</h1>
    <p>æ­¡è¿ä¾†åˆ° PUBGM å¥½å‹æ¨è–¦åŠ LINE ç¤¾ç¾¤ï¼èšé›†æˆ°å‹ã€åˆ†äº«æŠ€å·§ã€‚</p>
    <section id="social-links">
      <h2>åŠ å…¥æˆ‘å€‘çš„ç¤¾ç¾¤</h2>
      <a href="https://line.me/ti/g2/3R7YozDVnTR4ln5XjtR7tlxcMnloRpnggGwEng?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" class="btn">åŠ å…¥ LINE ç¤¾ç¾¤</a>
    </section>
    <section id="feedback">
      <h2>å¥½å‹æ¨è–¦è¡¨å–®</h2>
      <a href="https://forms.gle/qtwE592qaeD4Girv6" target="_blank" class="btn">å¡«å¯«æ¨è–¦è¡¨å–®</a>
    </section>
  </header>

  <main>
    <h2>å¥½å‹æ¨è–¦ç‰†</h2>
    <div id="teammate-list">è¼‰å…¥ä¸­...</div>
  </main>

  <footer>
    <p>Â© 2025 PUBGM å¥½å‹æ¨è–¦ç‰†</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    function clean(value) {
      if (!value) return "";
      return value.toString().trim().replace(/^"+|"+$/g, "").replace(/\r?\n/g, " ").replace(/\s+/g, " ");
    }

    function findKey(obj, keyword) {
      const keys = Object.keys(obj);
      for (let key of keys) {
        if (key.replace(/\s/g, '').includes(keyword.replace(/\s/g, ''))) return key;
      }
      return null;
    }

    function parseTimeText(str) {
      if (!str) return [];
      let cleanStr = str.replace(/^"+|"+$/g, "").replace(/\r?\n/g, " ").trim();
      if (!cleanStr) return [];
      let parts = cleanStr.split(/[,ã€\s]+/);
      if (parts.includes("ä¸ç©")) return ["ä¸ç©"];
      let unique = [...new Set(parts.filter(s => s))];
      const allDaySet = new Set(["æ¸…æ™¨","ä¸Šåˆ","ä¸­åˆ","ä¸‹åˆ","æ™šä¸Š","åŠå¤œ"]);
      const hasAllDayTimes = [...allDaySet].every(v => unique.includes(v));
      if (hasAllDayTimes) return ["å…¨å¤©"];
      return unique;
    }

    function displayTeammates(data) {
      const container = document.getElementById("teammate-list");
      container.innerHTML = "";
      if (!data || data.length === 0) {
        container.innerHTML = "<p>ç›®å‰æ²’æœ‰æ¨è–¦çš„éšŠå‹ã€‚</p>";
        return;
      }

      const weekDays = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"];

      data.forEach(item => {
        const idKey = findKey(item, "éšŠå‹ID") || findKey(item, "éšŠå‹ ID");
        const uidKey = findKey(item, "éšŠå‹UID") || findKey(item, "éšŠå‹ UID");
        const idVal = idKey ? clean(item[idKey]) : "";
        const uidVal = uidKey ? clean(item[uidKey]) : "";
        const displayID = idVal && uidVal ? `${idVal} (UID: ${uidVal})` : idVal || `(UID: ${uidVal})` || "ç„¡IDè³‡æ–™";
        const roleKey = findKey(item, "æ“…é•·è§’è‰²") || findKey(item, "æ“…é•·æ‰®æ¼”è§’è‰²");
        const techKey = findKey(item, "æŠ€è¡“é¡å‹") || findKey(item, "æŠ€è¡“é¡å‹(è‡ªè©•)");
        const noteKey = findKey(item, "æƒ³è£œå……") || findKey(item, "å‚™è¨»");
        const satisfactionKey = findKey(item, "æ»¿æ„åº¦");
        const likeKey = findKey(item, "å–œæ„›åº¦");

        let timesText = "";
        for (let i = 0; i < 7; i++) {
          const dayKey1 = `å¹³å¸¸éŠç©æ™‚é–“(è‹¥ç•¶å¤©ä¸ç©è«‹å¡«å¯«ä¸ç©) [æ˜ŸæœŸ${weekDays[i]}]`;
          const dayKey2 = findKey(item, `æ˜ŸæœŸ${weekDays[i]}`);
          const key = item.hasOwnProperty(dayKey1) ? dayKey1 : (dayKey2 || "");
          const valRaw = key ? clean(item[key]) : "";
          const times = parseTimeText(valRaw);

          if (times.length === 1 && times[0] === "ä¸ç©") {
            timesText += `ã€€${weekDays[i]}ï¼šä¸ç©<br>`;
          } else if (times.length === 1 && times[0] === "å…¨å¤©") {
            timesText += `ã€€${weekDays[i]}ï¼šå…¨å¤©<br>`;
          } else if (times.length > 0) {
            timesText += `ã€€${weekDays[i]}ï¼š${times.join(", ")}<br>`;
          } else {
            timesText += `ã€€${weekDays[i]}ï¼šç„¡è³‡æ–™<br>`;
          }
        }

        const card = document.createElement("div");
        card.className = "teammate-card";
        card.innerHTML = `
          <h3>ğŸ†” ${displayID}</h3>
          <div>ğŸ¯ æ“…é•·è§’è‰²ï¼š${roleKey ? clean(item[roleKey]) : "ç„¡"}</div>
          <div>ğŸ“Š æŠ€è¡“è©•åƒ¹ï¼š${techKey ? clean(item[techKey]) : "ç„¡"}</div>
          <div>ğŸ• å‡ºæ»¿æ™‚é–“ï¼š<br>${timesText}</div>
          <div>ğŸ’¬ å‚™è¨»ï¼š${noteKey ? clean(item[noteKey]) : "ç„¡"}</div>
          <div>â­ æ»¿æ„åº¦ï¼š${satisfactionKey ? clean(item[satisfactionKey]) : "ç„¡"}</div>
          <div>ğŸ’– å–œæ„›åº¦ï¼š${likeKey ? clean(item[likeKey]) : "ç„¡"}</div>
        `;
        container.appendChild(card);
      });
    }

    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR4C-YNnRgX3N71kURyPYn0K6Gt34uLFPm5DjiWzHf9DfKDzE3LIoEm2D8SqZoyrXycU4cIDK7qlgLd/pub?output=csv";

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        displayTeammates(results.data);
      },
      error: function(err) {
        document.getElementById("teammate-list").innerHTML = "<p>è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>";
        console.error(err);
      }
    });
  </script>
</body>
</html>
