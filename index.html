<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>éšŠå‹åˆ—è¡¨èˆ‡ç¶œåˆåˆ†é¡¯ç¤º</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", "Helvetica Neue", sans-serif;
      margin: 0; padding: 0;
      background-color: #f6f6f6; color: #333;
    }
    .teammate-card {
      background: white;
      border-radius: 10px;
      padding: 1em 1.2em;
      margin: 1em auto;
      max-width: 600px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .teammate-card h3 {
      margin-bottom: 0.5em;
      font-size: 1.2em;
    }
    .teammate-card p {
      margin: 0.25em 0;
      line-height: 1.5;
    }
    #teammate-list {
      text-align: center;
      font-size: 1.1em;
      color: #666;
      max-width: 700px;
      margin: 2em auto;
    }
  </style>
</head>
<body>

  <div id="teammate-list">è®€å–ä¸­...</div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    function clean(value) {
      if (!value) return "";
      return value.toString().trim().replace(/^"+|"+$/g, "").replace(/\r?\n/g, " ").replace(/\s+/g, " ");
    }

    function findKey(obj, keyword) {
      const keys = Object.keys(obj);
      for (let key of keys) {
        if (key.replace(/\s/g, '').includes(keyword.replace(/\s/g, ''))) {
          return key;
        }
      }
      return null;
    }

    function parseTimeText(str) {
      if (!str) return [];
      const raw = str.replace(/^"+|"+$/g, "").trim();
      if (!raw) return [];

      const allTimes = ["æ¸…æ™¨", "ä¸Šåˆ", "ä¸­åˆ", "ä¸‹åˆ", "æ™šä¸Š", "åŠå¤œ"];
      let parts = raw.split(/[,ã€\s]+/).filter(p => p && p !== "ï¼Œ");
      const unique = [...new Set(parts)];

      if (unique.includes("ä¸ç©")) return ["ä¸ç©"];
      if (unique.includes("å…¨å¤©") || allTimes.every(t => unique.includes(t))) return ["å…¨å¤©"];
      return unique;
    }

    function displayTeammates(data) {
      const container = document.getElementById("teammate-list");
      container.innerHTML = "";

      if (!data || data.length === 0) {
        container.innerHTML = "<p>ç›®å‰æ²’æœ‰æ¨è–¦çš„éšŠå‹ã€‚</p>";
        return;
      }

      const weekDays = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"];

      data.forEach(item => {
        const idKey = findKey(item, "éšŠå‹ID") || findKey(item, "éšŠå‹ ID") || findKey(item, "ID");
        const uidKey = findKey(item, "UID");

        const idVal = idKey ? clean(item[idKey]) : "";
        const uidVal = uidKey ? clean(item[uidKey]) : "";

        const displayID = idVal && uidVal
          ? `${idVal}ï¼ˆUID: ${uidVal}ï¼‰`
          : idVal
            ? idVal
            : uidVal
              ? `UID: ${uidVal}`
              : "æœªæä¾›";

        const roleKey = findKey(item, "æ“…é•·è§’è‰²");
        const techKey = findKey(item, "æŠ€è¡“é¡å‹");
        const noteKey = findKey(item, "å‚™è¨»") || findKey(item, "æƒ³è£œå……");
        const satisfactionKey = findKey(item, "æ»¿æ„åº¦");
        const likeKey = findKey(item, "å–œæ„›åº¦");

        const satisfaction = satisfactionKey ? Number(clean(item[satisfactionKey])) : 0;
        const like = likeKey ? Number(clean(item[likeKey])) : 0;
        let averageScore = null;
        if (satisfaction > 0 || like > 0) {
          averageScore = ((satisfaction + like) / 2).toFixed(2);
        }

        let timesText = "";
        for (let i = 0; i < 7; i++) {
          const dayKey = findKey(item, `æ˜ŸæœŸ${weekDays[i]}`);
          const raw = dayKey ? clean(item[dayKey]) : "";
          const parsed = parseTimeText(raw);

          if (parsed.length === 1) {
            timesText += `ã€€${weekDays[i]}ï¼š${parsed[0]}<br>`;
          } else if (parsed.length > 1) {
            timesText += `ã€€${weekDays[i]}ï¼š${parsed.join(", ")}<br>`;
          } else {
            timesText += `ã€€${weekDays[i]}ï¼šç„¡è³‡æ–™<br>`;
          }
        }

        const card = document.createElement("div");
        card.className = "teammate-card";
        card.innerHTML = `
          <h3>ğŸ†” ${displayID}</h3>
          <p>ğŸ¯ æ“…é•·è§’è‰²ï¼š${roleKey ? clean(item[roleKey]) : "ç„¡"}</p>
          <p>ğŸ“Š æŠ€è¡“è©•åƒ¹ï¼š${techKey ? clean(item[techKey]) : "ç„¡"}</p>
          <p>ğŸ• å‡ºæ²’æ™‚é–“ï¼š<br>${timesText}</p>
          <p>ğŸ’¬ å‚™è¨»ï¼š${noteKey ? clean(item[noteKey]) : "ç„¡"}</p>
          <p>â­ æ»¿æ„åº¦ï¼š${satisfactionKey ? clean(item[satisfactionKey]) : "ç„¡"}</p>
          <p>ğŸ’– å–œæ„›åº¦ï¼š${likeKey ? clean(item[likeKey]) : "ç„¡"}</p>
          ${averageScore !== null ? `<p>ğŸŒŸ ç¶œåˆåˆ†ï¼š${averageScore}</p>` : ""}
        `;
        container.appendChild(card);
      });
    }

    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR4C-YNnRgX3N71kURyPYn0K6Gt34uLFPm5DjiWzHf9DfKDzE3LIoEm2D8SqZoyrXycU4cIDK7qlgLd/pub?output=csv";

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        displayTeammates(results.data);
      },
      error: function(err) {
        document.getElementById("teammate-list").innerHTML = "<p>è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>";
        console.error(err);
      }
    });
  </script>

</body>
</html>
